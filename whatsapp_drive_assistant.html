<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhatsApp Google Drive Assistant</title>
    <!-- Simulation Strategy: This app simulates the WhatsApp-driven Google Drive assistant described in Task 2. Key components are: 1. **UI:** A realistic WhatsApp chat interface with a header, message area, and input field. 2. **State Management:** A JavaScript object ('mockFileSystem') acts as a virtual Google Drive, holding folders and files. This allows the simulation to realistically handle commands like LIST, MOVE, DELETE, and RENAME. 3. **Command Parser:** A function parses user input, identifying the command and its arguments (e.g., folder names, file names). 4. **Gemini Integration:** The 'SUMMARY' command triggers a call to the Gemini API to generate a summary of mock file content, demonstrating the AI requirement. 5. **Interactivity:** The app provides immediate feedback for valid commands, errors, and loading states, creating a high-fidelity user experience without needing a live backend. -->
    <!-- Resiliency Update: The callGemini function now includes a fallback mechanism. If the live API call fails after 3 retries, it will return a pre-written mock summary. This ensures the demo is always successful, even with intermittent network issues. -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
        }
        .chat-bg {
            background-color: #e5ddd5;
            background-image: url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png');
        }
        .chat-bubble-user {
            background-color: #dcf8c6;
        }
        .chat-bubble-bot {
            background-color: #ffffff;
        }
        .gemini-spinner {
            border: 3px solid rgba(0, 0, 0, 0.1);
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border-left-color: #075e54;
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-200 flex items-center justify-center h-screen">

    <div class="w-full max-w-md h-full sm:h-[90vh] flex flex-col bg-white shadow-2xl rounded-lg overflow-hidden">
        <!-- Chat Header -->
        <header class="bg-[#075e54] text-white p-3 flex items-center shadow-md z-10">
            <i class="fas fa-arrow-left text-xl mr-4 cursor-pointer"></i>
            <img src="https://placehold.co/40x40/0d244f/ffffff?text=G" alt="Profile Pic" class="rounded-full h-10 w-10 mr-3">
            <div>
                <h1 class="font-semibold text-lg">G-Drive Assistant</h1>
                <p class="text-xs text-gray-300">online</p>
            </div>
            <div class="ml-auto flex items-center space-x-4">
                <i class="fas fa-video"></i>
                <i class="fas fa-phone"></i>
                <i class="fas fa-ellipsis-v"></i>
            </div>
        </header>

        <!-- Chat Messages -->
        <main id="chat-messages" class="flex-1 overflow-y-auto p-4 chat-bg">
            <!-- Messages will be dynamically added here -->
        </main>

        <!-- Message Input -->
        <footer class="bg-gray-100 p-2 flex items-center">
            <div class="flex-1 bg-white rounded-full flex items-center px-4 py-2">
                <i class="far fa-laugh text-gray-500 text-xl"></i>
                <input type="text" id="message-input" placeholder="Type a command..." class="flex-1 mx-3 focus:outline-none">
                <i class="fas fa-paperclip text-gray-500 text-xl mr-3"></i>
                <i class="fas fa-camera text-gray-500 text-xl"></i>
            </div>
            <button id="send-button" class="bg-[#128c7e] text-white rounded-full h-12 w-12 flex items-center justify-center ml-2">
                <i class="fas fa-paper-plane text-xl"></i>
            </button>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const chatMessages = document.getElementById('chat-messages');
            const messageInput = document.getElementById('message-input');
            const sendButton = document.getElementById('send-button');

            // --- Mock File System ---
            let mockFileSystem = {
                'Reports': {
                    type: 'folder',
                    content: {
                        'Q1_Sales.pdf': { type: 'file', content: 'Q1 sales were strong, driven by new product launches.' },
                        'performance_review.txt': { type: 'file', content: 'Employee performance was exceptional across the board.' }
                    }
                },
                'Archive': {
                    type: 'folder',
                    content: {}
                },
                'Legal': {
                    type: 'folder',
                    content: {
                        'contract.pdf': { type: 'file', content: 'This agreement outlines the terms and conditions...' }
                    }
                }
            };

            // --- Initial Bot Message ---
            setTimeout(() => {
                addBotMessage(`Hello! I'm your Google Drive Assistant. You can manage your files by sending me commands.\n\nTry typing: \n*LIST /Reports*`);
            }, 500);

            // --- Event Listeners ---
            sendButton.addEventListener('click', handleUserInput);
            messageInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    handleUserInput();
                }
            });

            // --- Core Functions ---
            function handleUserInput() {
                const message = messageInput.value.trim();
                if (!message) return;

                addUserMessage(message);
                messageInput.value = '';

                setTimeout(() => processCommand(message), 1000);
            }
            
            function processCommand(message) {
                const parts = message.split(' ');
                const command = parts[0].toUpperCase();
                const args = parts.slice(1);

                switch (command) {
                    case 'LIST':
                        handleList(args);
                        break;
                    case 'DELETE':
                        handleDelete(args);
                        break;
                    case 'MOVE':
                        handleMove(args);
                        break;
                    case 'SUMMARY':
                        handleSummary(args);
                        break;
                    case 'RENAME':
                        handleRename(args);
                        break;
                    case 'UPLOAD':
                        handleUpload(args);
                        break;
                    default:
                        addBotMessage(`Sorry, I don't understand the command "${command}".\n\nAvailable commands are: LIST, DELETE, MOVE, SUMMARY, RENAME, UPLOAD.`);
                }
            }
            
            // --- Command Handlers ---
            function handleList(args) {
                const path = args[0];
                if (!path) {
                    addBotMessage("Please specify a folder. Usage: LIST /FolderName");
                    return;
                }
                const folderName = path.replace('/', '');
                const folder = mockFileSystem[folderName];

                if (folder && folder.type === 'folder') {
                    const files = Object.keys(folder.content);
                    if (files.length === 0) {
                        addBotMessage(`üìÅ The folder *${folderName}* is empty.`);
                    } else {
                        const fileList = files.map(f => `üìÑ ${f}`).join('\n');
                        addBotMessage(`Files in *${folderName}*:\n${fileList}`);
                    }
                } else {
                    addBotMessage(`‚ùå Error: Folder named *${folderName}* not found.`);
                }
            }
            
            function handleDelete(args) {
                const path = args[0];
                if (!path) {
                    addBotMessage("Usage: DELETE /FolderName/file.pdf");
                    return;
                }
                const [_, folderName, fileName] = path.split('/');
                if (mockFileSystem[folderName]?.content[fileName]) {
                    delete mockFileSystem[folderName].content[fileName];
                    addBotMessage(`‚úÖ Successfully deleted *${fileName}* from *${folderName}*.`);
                } else {
                    addBotMessage(`‚ùå Error: File *${fileName}* not found in *${folderName}*.`);
                }
            }

            function handleMove(args) {
                const [sourcePath, destPath] = args;
                if (!sourcePath || !destPath) {
                    addBotMessage("Usage: MOVE /SourceFolder/file.pdf /DestinationFolder");
                    return;
                }
                const [_, sourceFolder, fileName] = sourcePath.split('/');
                const [__, destFolder] = destPath.split('/');

                if (!mockFileSystem[sourceFolder]?.content[fileName]) {
                    addBotMessage(`‚ùå Error: File *${fileName}* not found in *${sourceFolder}*.`);
                } else if (!mockFileSystem[destFolder] || mockFileSystem[destFolder].type !== 'folder') {
                    addBotMessage(`‚ùå Error: Destination folder *${destFolder}* not found.`);
                } else {
                    const fileData = mockFileSystem[sourceFolder].content[fileName];
                    delete mockFileSystem[sourceFolder].content[fileName];
                    mockFileSystem[destFolder].content[fileName] = fileData;
                    addBotMessage(`‚úÖ Moved *${fileName}* from *${sourceFolder}* to *${destFolder}*.`);
                }
            }

            async function handleSummary(args) {
                const path = args[0];
                 if (!path) {
                    addBotMessage("Usage: SUMMARY /FolderName/file.pdf");
                    return;
                }
                const [_, folderName, fileName] = path.split('/');
                const file = mockFileSystem[folderName]?.content[fileName];
                
                if (!file) {
                    addBotMessage(`‚ùå Error: File *${fileName}* not found in *${folderName}*.`);
                    return;
                }

                const loadingMsgElement = addBotMessage(`<div class="flex items-center space-x-2"><div class="gemini-spinner"></div><span>Generating summary with Gemini...</span></div>`, true);
                
                const prompt = `Summarize the following document content in one short sentence: "${file.content}"`;
                const summary = await callGemini(prompt, fileName);
                
                loadingMsgElement.innerHTML = `üìù *Summary of ${fileName}:*\n${summary}`;
            }

            function handleRename(args) {
                const [oldName, newName] = args;
                if (!oldName || !newName) {
                     addBotMessage("Usage: RENAME oldfile.pdf newfile.pdf");
                    return;
                }
                
                let found = false;
                for (const folderName in mockFileSystem) {
                    const folder = mockFileSystem[folderName];
                    if (folder.content[oldName]) {
                        folder.content[newName] = folder.content[oldName];
                        delete folder.content[oldName];
                        addBotMessage(`‚úÖ Renamed *${oldName}* to *${newName}*.`);
                        found = true;
                        break;
                    }
                }
                if (!found) {
                     addBotMessage(`‚ùå Error: File *${oldName}* not found in any folder.`);
                }
            }
            
            function handleUpload(args) {
                addBotMessage(`This is a simulation. If you had shared a file with the message "${args.join(' ')}", I would upload it to the specified folder now.`);
            }

            // --- Gemini API Call ---
            async function callGemini(prompt, fileName) {
                const apiKey = ""; // Handled by environment
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                const payload = { contents: [{ parts: [{ text: prompt }] }] };
                
                const maxRetries = 3;
                for (let i = 0; i < maxRetries; i++) {
                    try {
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (response.ok) {
                            const result = await response.json();
                            const summaryText = result.candidates?.[0]?.content?.parts?.[0]?.text;
                            if (summaryText) return summaryText;
                        }
                    } catch (error) {
                        console.error(`Gemini API call attempt ${i + 1} failed:`, error);
                    }
                    if (i < maxRetries - 1) {
                        await new Promise(res => setTimeout(res, 1000));
                    }
                }
                
                console.warn("Gemini API failed after all retries. Using mock summary as a fallback.");
                return `This is a mock summary for '${fileName}'. New product launches drove strong Q1 sales. (Note: AI service is currently unavailable).`;
            }


            // --- UI Helper Functions ---
            function addUserMessage(message) {
                const messageElement = document.createElement('div');
                messageElement.className = 'flex justify-end mb-3';
                messageElement.innerHTML = `
                    <div class="chat-bubble-user rounded-lg p-2 max-w-xs sm:max-w-sm text-sm shadow">
                        ${message}
                    </div>
                `;
                chatMessages.appendChild(messageElement);
                scrollToBottom();
            }

            function addBotMessage(message, returnElement = false) {
                const messageElement = document.createElement('div');
                messageElement.className = 'flex justify-start mb-3';
                const formattedMessage = message.replace(/\*(.*?)\*/g, '<strong>$1</strong>');
                messageElement.innerHTML = `
                    <div class="chat-bubble-bot rounded-lg p-2 max-w-xs sm:max-w-sm text-sm shadow">
                       ${formattedMessage}
                    </div>
                `;
                chatMessages.appendChild(messageElement);
                scrollToBottom();
                if (returnElement) {
                    return messageElement.querySelector('.chat-bubble-bot');
                }
            }
            
            function scrollToBottom() {
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
        });
    </script>
</body>
</html>

